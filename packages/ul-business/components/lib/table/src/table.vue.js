"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const u=require("element-plus/es");require("element-plus/es/components/base/style/css");require("element-plus/es/components/loading/style/css");require("element-plus/es/components/dialog/style/css");require("element-plus/es/components/pagination/style/css");require("element-plus/es/components/table/style/css");require("element-plus/es/components/popconfirm/style/css");require("element-plus/es/components/table-column/style/css");require("element-plus/es/components/form-item/style/css");require("element-plus/es/components/button/style/css");require("element-plus/es/components/icon/style/css");const e=require("vue"),R=require("./type.js"),N=require("@iconify/vue"),P=require("lodash"),W=require("element-plus/es/components/table/src/table/defaults"),G={class:"ul-table"},H={key:0,class:"ul-table__search"},J={class:"ul-table__content"},Q={class:"table-head"},X={key:1},Y={key:1},Z={key:1},ee={class:"operate-box"},te={class:"dialog-footer"},oe=e.defineComponent({name:"UlTable",__name:"table",props:R.tableProps,setup(D){const a=D;e.useCssVars(t=>({"8cd1ef16":t.opWidth,"0efe32e9":t.pagingAlign}));const s=e.inject("table"),y=a.pageKey??(s==null?void 0:s.sizeKey)??"pageSize",C=a.sizeKey??(s==null?void 0:s.pageKey)??"PageNo",h=e.ref(),V=e.ref(!1),x=e.ref([]),v=e.ref(0),k=e.reactive({[y]:1,[C]:10}),T=t=>{const o={};return Object.keys(W).forEach(l=>{t[l]&&(o[l]=t[l])}),o},b=t=>{const{label:o,component:l,el:i,children:p,...d}=t;return d},f=async()=>{var t,o;if(a.getList){V.value=!0;const l=(o=(t=h.value)==null?void 0:t.getValue)==null?void 0:o.call(t),i=await a.getList({...k,...l}),p=a.dataPath??(s==null?void 0:s.dataPath)??"data",d=a.totalPath??(s==null?void 0:s.totalPath)??"total";x.value=P.get(i,p),v.value=P.get(i,d),V.value=!1}};a.immediate&&f();const S=()=>{var t,o,l;(l=(o=(t=h.value)==null?void 0:t.elFrom)==null?void 0:o.resetFields)==null||l.call(o),f()},F=t=>{k[C]=t,f()},q=t=>{k[y]=t,f()},r=e.reactive({visible:!1,title:"",disabled:!1,saveType:""}),g=e.ref(),z=()=>{var t,o,l;(l=(o=(t=g.value)==null?void 0:t.elFrom)==null?void 0:o.resetFields)==null||l.call(o)},$=()=>{if(a.onNew){a.onNew();return}r.title="新增",r.visible=!0,r.disabled=!1,r.saveType="new"},w=async t=>{let o=t;a.getDetail&&(o=await a.getDetail(t)),e.nextTick(()=>{var l,i;(i=(l=g.value)==null?void 0:l.setValue)==null||i.call(l,o)})},K=async t=>{a.deleteSumbit&&a.deleteSumbit(t)},U=async t=>{if(a.onEdit){a.onEdit(t);return}r.title="编辑",r.visible=!0,r.disabled=!1,r.saveType="edit",w(t)},I=async t=>{if(a.onView){a.onView(t);return}r.title="查看",r.visible=!0,r.disabled=!0,w(t)},L=async()=>{var t,o,l;(l=(o=(t=g.value)==null?void 0:t.elFrom)==null?void 0:o.validate)==null||l.call(o,async i=>{var d,m;if(!i)return;let p=a.newSumbit;if(r.saveType==="edit"&&(p=a.editSumbit),p){const B=(m=(d=g.value)==null?void 0:d.getValue)==null?void 0:m.call(d);await p(B)!==!1&&(r.visible=!1,f())}})};return(t,o)=>{const l=u.ElIcon,i=u.ElButton,p=u.ElFormItem,d=e.resolveComponent("ul-form"),m=u.ElTableColumn,B=u.ElPopconfirm,E=u.ElTable,O=u.ElPagination,j=u.ElDialog,A=u.ElLoadingDirective;return e.openBlock(),e.createElementBlock("div",G,[t.searchForms.length>0?(e.openBlock(),e.createElementBlock("div",H,[e.createVNode(d,{ref_key:"searchForm",ref:h,content:t.searchForms,inline:""},{final:e.withCtx(()=>[e.createVNode(p,null,{default:e.withCtx(()=>[e.createVNode(i,{type:"primary",onClick:f},{icon:e.withCtx(()=>[e.createVNode(l,null,{default:e.withCtx(()=>[e.createVNode(e.unref(N.Icon),{icon:"ep:search"})]),_:1})]),default:e.withCtx(()=>[e.createTextVNode(" 查询 ")]),_:1}),e.createVNode(i,{onClick:S},{icon:e.withCtx(()=>[e.createVNode(l,null,{default:e.withCtx(()=>[e.createVNode(e.unref(N.Icon),{icon:"ep:refresh"})]),_:1})]),default:e.withCtx(()=>[e.createTextVNode(" 重置 ")]),_:1})]),_:1})]),_:1},8,["content"])])):e.createCommentVNode("",!0),e.createElementVNode("div",J,[e.createElementVNode("div",Q,[e.createVNode(i,{type:"primary",onClick:$},{icon:e.withCtx(()=>[e.createVNode(l,null,{default:e.withCtx(()=>[e.createVNode(e.unref(N.Icon),{icon:"ep:plus"})]),_:1})]),default:e.withCtx(()=>[e.createTextVNode(" 新增 ")]),_:1}),e.renderSlot(t.$slots,"head")]),e.withDirectives((e.openBlock(),e.createBlock(E,e.mergeProps({border:""},T(t.$props),{data:x.value,"element-loading-text":"正在努力加载..."}),{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.columns,n=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[n.children?(e.openBlock(),e.createBlock(m,e.normalizeProps(e.mergeProps({key:0},b(n))),{header:e.withCtx(()=>[n.label&&typeof n.label=="function"?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.label()),{key:0})):(e.openBlock(),e.createElementBlock("span",X,e.toDisplayString(n.label),1))]),default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.children,c=>(e.openBlock(),e.createBlock(m,e.mergeProps({key:c.prop},b(c)),{header:e.withCtx(()=>[c.label&&typeof c.label=="function"?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(c.label()),{key:0})):(e.openBlock(),e.createElementBlock("span",Y,e.toDisplayString(c.label),1))]),default:e.withCtx(({row:_})=>[c.component?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(c.component),e.mergeProps({key:0,modelValue:_[c.prop],"onUpdate:modelValue":M=>_[c.prop]=M},c.el),null,16,["modelValue","onUpdate:modelValue"])):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createTextVNode(e.toDisplayString(_[c.prop]),1)],64))]),_:2},1040))),128))]),_:2},1040)):(e.openBlock(),e.createBlock(m,e.normalizeProps(e.mergeProps({key:1},b(n))),{header:e.withCtx(()=>[n.label&&typeof n.label=="function"?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.label()),{key:0})):(e.openBlock(),e.createElementBlock("span",Z,e.toDisplayString(n.label),1))]),default:e.withCtx(({row:c})=>[n.component?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(n.component),e.mergeProps({key:0,modelValue:c[n.prop],"onUpdate:modelValue":_=>c[n.prop]=_},n.el),null,16,["modelValue","onUpdate:modelValue"])):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createTextVNode(e.toDisplayString(c[n.prop]),1)],64))]),_:2},1040))],64))),256)),t.hasOperateColumn&&t.columns.length>0?(e.openBlock(),e.createBlock(m,{key:0,label:"操作",align:"center",fixed:"right"},{default:e.withCtx(({row:n})=>[e.createElementVNode("div",ee,[e.createVNode(i,{link:"",type:"primary",onClick:c=>I(n)},{default:e.withCtx(()=>[e.createTextVNode("查看")]),_:2},1032,["onClick"]),e.createVNode(i,{link:"",type:"primary",onClick:c=>U(n)},{default:e.withCtx(()=>[e.createTextVNode("编辑")]),_:2},1032,["onClick"]),e.createVNode(B,{title:"确定要删除该数据吗?","confirm-button-type":"danger","confirm-button-text":"删除",onClick:K},{reference:e.withCtx(()=>[e.createVNode(i,{link:"",type:"danger"},{default:e.withCtx(()=>[e.createTextVNode("删除")]),_:1})]),_:1}),e.renderSlot(t.$slots,"extraOp")])]),_:3})):e.createCommentVNode("",!0)]),_:3},16,["data"])),[[A,V.value]]),t.hasPagination&&v.value>0?(e.openBlock(),e.createBlock(O,e.mergeProps({key:0,class:"paging-box",layout:"total, sizes, prev, pager, next, jumper",background:"",small:""},t.pagingAttr,{"current-page":k[e.unref(y)],"page-size":k[e.unref(C)],total:v.value,onSizeChange:F,onCurrentChange:q}),null,16,["current-page","page-size","total"])):e.createCommentVNode("",!0)]),e.createVNode(j,{modelValue:r.visible,"onUpdate:modelValue":o[2]||(o[2]=n=>r.visible=n),title:r.title,onClose:z},e.createSlots({default:e.withCtx(()=>[e.createVNode(d,{ref_key:"dialogForm",ref:g,disabled:r.disabled,content:t.forms},null,8,["disabled","content"])]),_:2},[r.disabled?void 0:{name:"footer",fn:e.withCtx(()=>[e.createElementVNode("span",te,[e.createVNode(i,{onClick:o[0]||(o[0]=n=>r.visible=!1)},{default:e.withCtx(()=>[e.createTextVNode("取消")]),_:1}),e.createVNode(i,{type:"primary",onClick:o[1]||(o[1]=n=>L())},{default:e.withCtx(()=>[e.createTextVNode(" 保存 ")]),_:1})])]),key:"0"}]),1032,["modelValue","title"])])}}});exports.default=oe;
